<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Event HUB — Contact / Register</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <main class="container">
    <header>
      <h1>The Event HUB</h1>
      <p class="lead">Tell us about your event — we'll connect you with volunteers & coordinators.</p>
    </header>

    <form id="eventForm" class="form" novalidate>
      <div class="row two-col">
        <div>
          <label for="name">Name <span class="req">*</span></label>
          <input id="name" name="name" type="text" placeholder="Full name" required />
        </div>

        <div>
          <label for="email">Email <span class="req">*</span></label>
          <input id="email" name="email" type="email" placeholder="you@domain.com" required />
        </div>
      </div>

      <div class="row two-col">
        <div>
          <label for="mobile">Mobile <span class="req">*</span></label>
          <input id="mobile" name="mobile" type="tel" pattern="[0-9]{10}" placeholder="10-digit mobile" required />
        </div>

        <div>
          <label for="city">City (type PIN or city name) <span class="req">*</span></label>
          <input id="city" name="city" list="city-list" placeholder="Start typing PIN or city name" autocomplete="off" required />
          <datalist id="city-list"></datalist>
        </div>
      </div>

      <div class="row">
        <label for="eventType">Type of Event <span class="req">*</span></label>
        <select id="eventType" name="eventType" required>
          <option value="" disabled selected>Select event</option>
          <option value="Wedding">Wedding</option>
          <option value="Birthday">Birthday</option>
          <option value="Festival">Festival</option>
          <option value="Corporate">Corporate</option>
          <option value="Others">Others</option>
        </select>
      </div>

      <div id="otherBox" class="row hidden">
        <label for="otherText">Please describe <span class="req">*</span></label>
        <input id="otherText" name="otherText" type="text" placeholder="Describe the event" />
      </div>

      <div class="row">
        <button type="submit" class="btn">Submit</button>
      </div>

      <div id="message" role="status" aria-live="polite"></div>
    </form>

    <footer>
      <small>Designed responsive — works on mobile, tablet and desktop.</small>
    </footer>
  </main>

<script>
/*
  Updated behavior:
  - Required fields: name, email, mobile, city, eventType.
  - If 'Others' selected, otherText becomes required and visible.
  - City suggestions from small local sample + Indian PIN lookup via https://api.postalpincode.in/pincode/<pin>
  - On submit, form is POSTed to the provided Google Apps Script endpoint as FormData (so the script can access request parameters).
  - Shows success/error messages and handles basic client validation.
*/

const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby527xYCYsLBCmGY-gsQQ8o9F2-asdoiZARqHK-zuoAJAT_N_8RegprdyZUlWbHiF_YPg/exec';

const sampleCities = [
  { name: 'New Delhi', pincode: '110001' },
  { name: 'Mumbai', pincode: '400001' },
  { name: 'Bengaluru', pincode: '560001' },
  { name: 'Kolkata', pincode: '700001' },
  { name: 'Chennai', pincode: '600001' },
  { name: 'Pune', pincode: '411001' }
];

const cityInput = document.getElementById('city');
const cityList = document.getElementById('city-list');
const eventType = document.getElementById('eventType');
const otherBox = document.getElementById('otherBox');
const otherText = document.getElementById('otherText');
const form = document.getElementById('eventForm');
const message = document.getElementById('message');

function setDatalistOptions(options) {
  cityList.innerHTML = '';
  options.forEach(opt => {
    const el = document.createElement('option');
    el.value = opt;
    cityList.appendChild(el);
  });
}

cityInput.addEventListener('input', async (e) => {
  const v = e.target.value.trim();
  if (!v) { setDatalistOptions([]); return; }

  // If typed only digits -> treat as PIN partial or full
  if (/^\d+$/.test(v)) {
    // If length is 6, try official PIN API
    if (v.length === 6) {
      try {
        const res = await fetch('https://api.postalpincode.in/pincode/' + v);
        const data = await res.json();
        if (Array.isArray(data) && data[0] && data[0].Status === 'Success') {
          const names = data[0].PostOffice.map(p => `${p.District}${p.State ? ', ' + p.State : ''} (${p.Name})`);
          setDatalistOptions(names);
          return;
        }
      } catch (err) {
        // fallback to local list
      }
    }

    // Partial PIN: show local matches
    const matches = sampleCities
      .filter(c => c.pincode.startsWith(v))
      .map(c => `${c.name} (${c.pincode})`);
    setDatalistOptions(matches);
    return;
  }

  // Text input: filter by city name start
  const textMatches = sampleCities
    .filter(c => c.name.toLowerCase().startsWith(v.toLowerCase()))
    .map(c => `${c.name} (${c.pincode})`);
  setDatalistOptions(textMatches);
});

// Show/hide 'Others' box
eventType.addEventListener('change', () => {
  if (eventType.value === 'Others') {
    otherBox.classList.remove('hidden');
    otherText.setAttribute('required', '');
  } else {
    otherBox.classList.add('hidden');
    otherText.removeAttribute('required');
  }
});

function showMessage(txt, type = 'error') {
  message.textContent = txt;
  message.className = type === 'success' ? 'success' : 'error';
}

// Submit handler - sends FormData to provided Google Apps Script URL
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  // browser validation
  if (!form.checkValidity()) {
    showMessage('Please fill all required fields correctly.', 'error');
    // report validity to show native messages if needed
    form.reportValidity();
    return;
  }

  const formData = new FormData();
  formData.append('name', form.name.value.trim());
  formData.append('email', form.email.value.trim());
  formData.append('mobile', form.mobile.value.trim());
  formData.append('city', form.city.value.trim());
  formData.append('eventType', form.eventType.value);
  formData.append('other', form.otherText ? form.otherText.value.trim() : '');
  formData.append('source', 'The-Event-HUB');

  // Disable submit while sending
  const submitBtn = form.querySelector('button[type="submit"]');
  submitBtn.disabled = true;
  submitBtn.textContent = 'Sending...';
  showMessage('', '');

  try {
    const resp = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: formData,
    });

    let text;
    try { text = await resp.text(); } catch (e) { text = ''; }

    if (resp.ok) {
      showMessage('Thank you — your request has been received.', 'success');
      form.reset();
      otherBox.classList.add('hidden');
    } else {
      showMessage('Submission failed. Server returned an error. Try again later.', 'error');
      console.error('Submission error', resp.status, text);
    }
  } catch (err) {
    console.error('Submission exception', err);
    showMessage('Network error while sending. Please try again.', 'error');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit';
  }
});
</script>
</body>
</html>
